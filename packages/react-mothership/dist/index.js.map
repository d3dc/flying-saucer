{"version":3,"file":"index.js","sources":["../src/context.js","../src/scope/context.js","../src/path.js","../src/scope/Scope.js","../src/store/bindings.js","../src/store/rematchPreset.js","../src/store/createStore.js","../src/app/createApp.js","../src/app/Mothership.js","../src/app/bindings.js","../src/feature/Boundary.js","../src/router.js","../src/feature/createRoutes.js","../src/feature/createFeature.js"],"sourcesContent":["import { createContext, useContext } from 'react'\n\nexport const context = createContext(null)\nexport const useApp = () => useContext(context)\nexport const { Provider } = context\n\nexport default context\n","import { createContext, useContext } from 'react'\nimport { get } from 'lodash'\n\nclass NotProvidedInScopeError extends Error {\n  constructor(path, scope) {\n    super(`Path \"${path}\" not provided by feature \"${scope}\"`)\n    this.name = 'ViewNotFoundError'\n  }\n}\n\nexport const context = createContext({\n  name: 'root',\n  views: {},\n  provides: {},\n})\n\n// toolkit\nexport function useScope() {\n  return useContext(context)\n}\n\n// user\nexport function useProvided(...deps) {\n  const scope = useContext(context)\n  return deps.map(path => {\n    const val = get(scope.provides, path)\n    if (val === undefined) {\n      throw new NotProvidedInScopeError(path, scope.name)\n    }\n    return val\n  })\n}\n","import { trimStart, trimEnd } from 'lodash'\n\nexport function pathJoin(...parts) {\n  const slash = '/'\n  return parts.reduce((acc, p) => {\n    return p === slash\n      ? acc // preserve trailing slash\n      : [trimEnd(acc, slash), trimStart(p, slash)].join(slash)\n  })\n}\n\nexport function addLinks(dest, basePath, views) {\n  views.forEach(view => {\n    if (view.name) {\n      dest[view.name] = {\n        exact: view.exact,\n        resolve: view.resolve\n          ? (...args) => pathJoin(basePath, view.resolve(...args))\n          : () => pathJoin(basePath, view.path),\n      }\n    }\n  })\n}\n","import { Children, useMemo } from 'react'\nimport { merge } from 'lodash'\nimport { addLinks, pathJoin } from '../path'\nimport { useApp } from '../context'\nimport { context, useScope } from './context'\n\n/**\n * Primitive used by Features and Mothership\n * for providing their context\n\n * @param       {string} basePath\n *              base path for views\n *\n * @param       {ReactElement | ReactElement[]} hoist\n *              react children to visit while looking for\n *              values to hoist in this scope\n *\n * @param       {ReactElement | ReactElement[][type]} children\n *              rendered react children\n *\n * @param       {...} rest\n *              any additional values that should be defined in scope\n *\n */\nfunction Scope({ basePath, hoist, children, ...rest }) {\n  const parent = useScope()\n  const views = useViews(basePath, hoist)\n  const scope = merge({ views }, parent, rest)\n\n  useModels(hoist, scope)\n\n  return <context.Provider value={scope} children={children} />\n}\n\nScope.displayName = 'Scope'\n\nfunction useViews(basePath, hoisted) {\n  return useMemo(() => {\n    const views = {}\n    Children.forEach(hoisted, child => {\n      const featureName = child.type.featureConfig?.name\n      const featureViews = child.type.featureConfig?.views\n      const featurePath = pathJoin(basePath, child.props.path)\n\n      if (featureName) {\n        addLinks(views, featurePath, [\n          {\n            name: featureName,\n            exact: child.props.exact,\n            path: '/',\n          },\n        ])\n      }\n\n      if (featureViews) {\n        addLinks(views, featurePath, featureViews)\n      }\n    })\n    return views\n  }, [basePath, hoisted])\n}\n\nfunction useModels(hoisted, scope) {\n  const app = useApp()\n\n  useMemo(\n    () =>\n      Children.forEach(hoisted, child => {\n        const featureModels = child.type.featureConfig?.models\n\n        if (!featureModels) {\n          return\n        }\n\n        app.registerModels(featureModels, scope)\n      }),\n    [app, hoisted]\n  )\n}\n\nexport default Scope\n","import { _ } from 'param.macro'\nimport { memo, createElement, useEffect } from 'react'\nimport { connect, useStore, useSelector, ReactReduxContext } from 'react-redux'\n\nexport { connect, useSelector, useDispatch, useStore } from 'react-redux'\n\nexport const withStore = connect\n\nexport const withDispatch = connect(\n  null,\n  _\n)\n\nexport const useAppEffect = (mapDispatch, watch) => {\n  const store = useStore()\n  useEffect(() => {\n    mapDispatch(store.dispatch)\n  }, watch)\n}\n\nexport const useAppSelector = (mapSelect, payload) => {\n  const store = useStore()\n  return useSelector(state => mapSelect(store.select)(state, payload))\n}\n\nexport const sconnect = (mapSelect, mapDispatch) => Base => {\n  // memoizes setup\n  const c = memo(props => {\n    return (\n      <ReactReduxContext.Consumer>\n        {store => {\n          const enhance = connect(\n            store.select(mapSelect),\n            mapDispatch\n          )\n\n          return createElement(enhance(Base), props)\n        }}\n      </ReactReduxContext.Consumer>\n    )\n  })\n\n  c.displayName = `sconnect(${Base.displayName || Base.name || 'Component'})`\n\n  return c\n}\n\nexport const withStoreSelection = sconnect\n\nexport const $$ = sconnect\nexport const _$ = withDispatch\n","import selectPlugin from '@rematch/select'\n\nexport default {\n  plugins: [selectPlugin()],\n}\n","import { init } from '@rematch/core'\nimport preset from './rematchPreset'\n\nexport default config =>\n  init({\n    ...preset,\n    ...config,\n  })\n","import { mapValues } from 'lodash'\nimport { createBrowserHistory } from 'history'\nimport { createStore } from '../store'\n\n// interface FlyingSaucerApp<ReduxStore, Model> {\n//   store: ReduxStore;\n//   history: History;\n//   registerModels: (models: Model[], scope: Scope) => void;\n//   navigate: (views: { [name]: View }) => { [name]: () => void }\n// }\n\nfunction enhance(model, inject) {\n  return {\n    ...model,\n    effects:\n      typeof model.effects === 'function'\n        ? (...args) => model.effects(...args, inject)\n        : model.effects,\n    selectors:\n      typeof model.selectors === 'function'\n        ? (...args) => model.selectors(...args, inject)\n        : model.selectors,\n  }\n}\n\n/**\n * Create the default kind of app using rematch redux and overloading models with inject.\n *\n * @param {{ rematch: RematchConfig, inject: {} }} config\n *\n * @returns FlyingSaucerApp<RematchStore, RematchModel>\n */\nexport default function createApp(config = {}) {\n  const registeredModels = {}\n  const store = createStore(config.rematch)\n  const { select, dispatch, getState } = store\n  const history = createBrowserHistory()\n\n  const inject = {\n    ...config.inject,\n    select,\n    dispatch,\n    getState,\n  }\n\n  function navigate(views) {\n    return mapValues(views, v => (...args) => history.push(v.resolve(...args)))\n  }\n\n  function registerModels(models, scope) {\n    models.forEach(model => {\n      if (registeredModels[model.name] !== model) {\n        const injected = { ...inject, navigator: navigate(scope.views) }\n        registeredModels[model.name] = model\n        store.model(enhance(model, injected))\n      }\n    })\n  }\n\n  return {\n    store,\n    history,\n    registerModels,\n    navigate,\n  }\n}\n","import { Router } from 'react-router'\nimport { Provider as StoreProvider } from 'react-redux'\nimport { Provider as AppProvider } from '../context'\nimport { Scope } from '../scope'\n\nimport createApp from './createApp'\n\nexport default function Mothership({ app = createApp(), children, ...rest }) {\n  return (\n    <AppProvider value={app}>\n      <StoreProvider store={app.store}>\n        <Scope name=\"root\" basePath=\"/\" hoist={children} provides={rest}>\n          <Router history={app.history}>{children}</Router>\n        </Scope>\n      </StoreProvider>\n    </AppProvider>\n  )\n}\n","import { useMemo } from 'react'\n\nimport { useApp } from '../context'\nimport { useScope } from '../scope'\n\nexport const useNavigator = () => {\n  const app = useApp()\n  const { views } = useScope()\n\n  return useMemo(() => app.navigate(views), [app, views])\n}\n","import { Suspense, Component } from 'react'\n\nexport default class Boundary extends Component {\n  state = {\n    hasError: false,\n  }\n\n  static getDerivedStateFromError = error => ({\n    hasError: true,\n  })\n\n  render() {\n    if (this.state.hasError) {\n      const { recovery = <div>Error!</div>, ...rest } = this.props\n      return recovery\n    } else {\n      const { fallback = <div>Loading...</div>, ...rest } = this.props\n      return <Suspense fallback={fallback} {...rest} />\n    }\n  }\n}\n","import { mapValues } from 'lodash'\nimport { createElement, useContext, useMemo } from 'react'\nimport { Redirect as BaseRedirect } from 'react-router'\nimport { Link as BaseLink, NavLink as BaseNavLink } from 'react-router-dom'\nimport { useScope } from './scope'\n\nexport class ViewNotFoundError extends Error {\n  constructor(view, scope) {\n    super(`View \"${view}\" not provided by feature \"${scope}\"`)\n    this.name = 'ViewNotFoundError'\n  }\n}\n\nconst enhance = Comp => ({ view, params, ...rest }) => {\n  const scope = useScope()\n  const [to, exact] = useMemo(\n    () => {\n      if (view) {\n        const config = scope?.views?.[view]\n        if (!config) {\n          throw new ViewNotFoundError(view, scope.name)\n        }\n        return [config.resolve(params), config.exact]\n      } else {\n        return [undefined, undefined]\n      }\n    },\n    [scope, view, params]\n  )\n\n  return createElement(Comp, {\n    to,\n    exact,\n    ...rest,\n  })\n}\n\nexport const Link = BaseLink |> enhance\nexport const NavLink = BaseNavLink |> enhance\nexport const Redirect = BaseRedirect |> enhance\nexport { Switch, Route } from 'react-router'\nexport { withRouter } from 'react-router'\n","import { it } from 'param.macro'\nimport { Route } from 'react-router'\n\nimport { pathJoin } from '../path'\nimport { useAppEffect } from '../store'\nimport { useProvided } from '../scope'\nimport { Redirect } from '../router'\n\nexport default function createRoutes(basePath, views) {\n  return views.map(({ path, component, effect, redirect, ...rest }) => {\n    const url = pathJoin(basePath, path)\n    const render = renderHooks(\n      effect && reduxHook(effect),\n      redirect && redirectHook(redirect)\n    )\n    return (\n      <Route key={url} path={url} component={component || render} {...rest} />\n    )\n  })\n}\n\nfunction renderHooks(...hooks) {\n  const used = hooks.filter(Boolean)\n\n  if (!used.length) {\n    return undefined\n  }\n\n  return () => used.map(it.call())\n}\n\nfunction reduxHook(effect) {\n  return () => {\n    useAppEffect(effect, [])\n    return null\n  }\n}\n\nfunction redirectHook(payload) {\n  let view, params\n  if (typeof payload === 'object') {\n    const { to, ...rest } = payload\n    view = to\n    params = rest\n  } else {\n    view = payload\n  }\n  return () => <Redirect key={view} view={view} params={params} />\n}\n","import { it } from 'param.macro'\nimport { useMemo, memo, Children } from 'react'\nimport { partition } from 'lodash'\nimport { withRouter, Switch, Route } from 'react-router'\n\nimport { Scope, useScope } from '../scope'\nimport { pathJoin } from '../path'\nimport createRoutes from './createRoutes'\nimport Boundary from './Boundary'\n\nexport default function createFeature(config = {}) {\n  return Base => {\n    const name = config.name || Base.displayName || Base.name\n\n    /*\n     * \"If a Route does not have a path, and therefore always matches,\n     * you'll get the closest parent match. Same goes for withRouter.\"\"\n     *\n     * https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/match.md\n     */\n    function Feature(props) {\n      const { provides, path, exact, match, children } = props\n      const basePath = pathJoin(match.path, path)\n      const routes = useRoutes(name, basePath, config.views)\n      const [withPath, nested] = usePartition(children)\n\n      const render = () => (\n        <Boundary fallback={config.placeholder} recovery={config.recovery}>\n          <Scope\n            name={name}\n            basePath={basePath}\n            provides={{\n              ...config.provides,\n              ...provides,\n            }}\n            hoist={children}\n          >\n            <Base {...props}>\n              <Switch>\n                {routes}\n                {withPath}\n              </Switch>\n              {nested}\n            </Base>\n          </Scope>\n        </Boundary>\n      )\n\n      return path ? (\n        // Wait to mount the Base, children and routing\n        // and run any effects they have\n        <Route path={basePath} exact={exact} render={render} />\n      ) : (\n        // \"always on\"\n        render()\n      )\n    }\n\n    const Wrapper = Feature |> memo |> withRouter\n\n    Wrapper.displayName = `Feature(${name || 'Component'})`\n    Wrapper.WrappedComponent = Base\n    Wrapper.featureConfig = {\n      ...config,\n      name,\n    }\n\n    return Wrapper\n  }\n}\n\nfunction useRoutes(name, basePath, views = []) {\n  // we know name and views won't change\n  // and only need to update when paths change\n  return useMemo(() => createRoutes(basePath, views), [basePath])\n}\n\nfunction usePartition(children) {\n  return useMemo(() => partition(Children.toArray(children), it.props.path), [\n    children,\n  ])\n}\n"],"names":["context","createContext","useApp","useContext","Provider","NotProvidedInScopeError","path","scope","name","Error","views","provides","useScope","useProvided","deps","map","val","undefined","pathJoin","slash","parts","reduce","acc","p","join","addLinks","dest","basePath","forEach","view","exact","resolve","Scope","hoist","children","rest","parent","useViews","useModels","displayName","hoisted","useMemo","Children","child","featureName","type","featureConfig","featureViews","featurePath","props","app","featureModels","models","registerModels","withStore","connect","withDispatch","useAppEffect","mapDispatch","watch","store","useStore","useEffect","dispatch","useAppSelector","mapSelect","payload","useSelector","state","select","sconnect","Base","c","memo","enhance","createElement","withStoreSelection","$$","_$","plugins","selectPlugin","config","init","preset","model","inject","effects","args","selectors","createApp","registeredModels","createStore","rematch","getState","history","createBrowserHistory","navigate","v","push","injected","navigator","Mothership","AppProvider","StoreProvider","useNavigator","Boundary","hasError","recovery","fallback","Component","getDerivedStateFromError","error","ViewNotFoundError","Comp","params","to","Link","BaseLink","NavLink","BaseNavLink","Redirect","BaseRedirect","createRoutes","component","effect","redirect","url","render","renderHooks","reduxHook","redirectHook","hooks","used","filter","Boolean","length","it","call","createFeature","Feature","match","routes","useRoutes","usePartition","withPath","nested","placeholder","Wrapper","withRouter","WrappedComponent","toArray"],"mappings":"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"}